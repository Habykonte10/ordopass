<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Facturation Pharmacie - OrdoPass</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f6f9;
  margin:0;
}

.header{
  background:#0d6efd;
  color:white;
  padding:20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.header h1{
  margin:0;
}

.container{
  padding:30px;
}

.card{
  background:white;
  padding:25px;
  border-radius:10px;
  box-shadow:0 2px 10px rgba(0,0,0,0.1);
}

input, select{
  padding:10px;
  border-radius:6px;
  border:1px solid #ccc;
  width:100%;
}

.table{
  width:100%;
  border-collapse:collapse;
  margin-top:20px;
}

.table th, .table td{
  border:1px solid #ddd;
  padding:10px;
  text-align:center;
}

.table th{
  background:#0d6efd;
  color:white;
}

.btn{
  padding:10px 15px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
}

.btn-primary{
  background:#0d6efd;
  color:white;
}

.btn-success{
  background:#28a745;
  color:white;
}

.total-box{
  margin-top:20px;
  text-align:right;
  font-size:18px;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="header">
  <h1><i class="fa-solid fa-prescription-bottle-medical"></i> PHARMACIE ORDOPASS</h1>
  <span>Facture Officielle</span>
</div>

<div class="container">
<div class="card">

<h2>Informations Client</h2>

<div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
  <input type="text" id="clientNom" placeholder="Nom du client">
  <input type="date" id="factureDate">
  <input type="text" id="clientTel" placeholder="Téléphone">
  <input type="text" id="factureNumero" placeholder="N° Facture">
</div>

<hr style="margin:25px 0;">

<h2>Médicaments</h2>

<table class="table" id="medTable">
<thead>
<tr>
<th>Médicament</th>
<th>Quantité</th>
<th>Prix Unitaire</th>
<th>Total</th>
<th></th>
</tr>
</thead>
<tbody></tbody>
</table>

<br>
<button class="btn btn-primary" onclick="addRow()">
<i class="fa fa-plus"></i> Ajouter médicament
</button>

<div class="total-box">
TOTAL : <span id="grandTotal">0</span> FCFA
</div>

<br><br>

<button class="btn btn-success" onclick="generatePDF()">
<i class="fa fa-file-pdf"></i> Générer PDF
</button>

</div>
</div>

<script>

function addRow(){
  const table = document.querySelector("#medTable tbody");

  const row = document.createElement("tr");

  row.innerHTML = `
  <td><input type="text" placeholder="Nom médicament"></td>
  <td><input type="number" value="1" min="1" onchange="calculate()"></td>
  <td><input type="number" value="0" min="0" onchange="calculate()"></td>
  <td class="rowTotal">0</td>
  <td><button onclick="this.parentElement.parentElement.remove(); calculate()">X</button></td>
  `;

  table.appendChild(row);
}

function calculate(){
  let grandTotal = 0;

  document.querySelectorAll("#medTable tbody tr").forEach(row=>{
    const qty = row.children[1].querySelector("input").value;
    const price = row.children[2].querySelector("input").value;

    const total = qty * price;
    row.querySelector(".rowTotal").innerText = total;
    grandTotal += total;
  });

  document.getElementById("grandTotal").innerText = grandTotal;
}

function generatePDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.setFontSize(18);
  doc.text("PHARMACIE ORDOPASS", 70, 20);

  doc.setFontSize(12);
  doc.text("Client : " + document.getElementById("clientNom").value, 20, 40);
  doc.text("Téléphone : " + document.getElementById("clientTel").value, 20, 50);
  doc.text("Date : " + document.getElementById("factureDate").value, 150, 40);
  doc.text("Facture N° : " + document.getElementById("factureNumero").value, 150, 50);

  let y = 70;

  doc.text("Médicaments :", 20, y);
  y += 10;

  document.querySelectorAll("#medTable tbody tr").forEach(row=>{
    const name = row.children[0].querySelector("input").value;
    const qty = row.children[1].querySelector("input").value;
    const price = row.children[2].querySelector("input").value;
    const total = row.querySelector(".rowTotal").innerText;

    doc.text(`${name} | Qté: ${qty} | PU: ${price} | Total: ${total}`, 20, y);
    y += 10;
  });

  y += 10;
  doc.setFontSize(14);
  doc.text("TOTAL : " + document.getElementById("grandTotal").innerText + " FCFA", 20, y);

  doc.save("facture_pharmacie.pdf");
}

document.getElementById("factureDate").value = new Date().toISOString().split('T')[0];

</script>

</body>
</html>
