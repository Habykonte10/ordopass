<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Nouvelle Consultation - OrdoPass</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body class="dashboard-page">

<!-- ================= SIDEBAR ================= -->
<aside class="sidebar">
  <div class="logo"><i class="fa-solid fa-notes-medical"></i> ORDOPASS</div>
  <nav>
    <a href="medecin_dashboard.html"><i class="fa-solid fa-file-medical"></i> Consultations</a>
    <a href="patients.html"><i class="fa-solid fa-users"></i> Patients</a>
    <a href="teleconsultation.html"><i class="fa-solid fa-video"></i> Téléconsultation</a>
    <a href="pharmacies.html"><i class="fa-solid fa-prescription-bottle-medical"></i> Pharmacies</a>
    <a href="#" id="logout"><i class="fa-solid fa-right-from-bracket"></i> Déconnexion</a>
  </nav>
</aside>

<!-- ================= MAIN ================= -->
<main class="main-area">

<header class="topbar">
  <h1>Nouvelle consultation</h1>
  <span id="usernameDisplay"></span>
</header>

<section class="content">
  <div class="card">

<form id="consultationForm">

<h3>Informations patient</h3>

<input id="ticket" placeholder="Numéro de ticket" required>
<input id="nom" placeholder="Nom" required>
<input id="prenom" placeholder="Prénom" required>
<input id="age" type="number" placeholder="Âge" required>
<input id="telephone" placeholder="Téléphone">
<input id="adresse" placeholder="Adresse">
<input id="image" placeholder="URL image (optionnel)">

<h3>Consultation</h3>

<input id="date" type="date" required>
<input id="heure" type="time" required>
<input id="motif" placeholder="Motif" required>

<select id="statut">
  <option>En attente</option>
  <option>En cours</option>
  <option>Terminé</option>
</select>

<!-- ================= BOUTONS ================= -->
<div style="margin-top:20px; display:flex; gap:10px; flex-wrap:wrap">

<button type="button" class="btn-success" id="saveAllBtn">
  <i class="fa-solid fa-user-plus"></i> Ajouter patient et consultation
</button>

<button type="button" class="btn-outline" onclick="history.back()">
  Retour
</button>

</div>

</form>
</div>
</section>
</main>

<!-- ================= SCRIPT ================= -->
<script>
/* ===== AUTH ===== */
const user = JSON.parse(localStorage.getItem("user"));
if(!user || user.role !== "medecin"){
  alert("Accès refusé");
  location.href = "medecin_login.html";
}
document.getElementById("usernameDisplay").textContent = user.username;

/* ===== SAVE PATIENT + CONSULTATION ===== */
document.getElementById("saveAllBtn").addEventListener("click", ()=>{

  const patient = {
    id: Date.now(),
    name: nom.value + " " + prenom.value,
    age: age.value,
    phone: telephone.value,
    address: adresse.value,
    image: image.value || "https://i.pravatar.cc/40",
    added: new Date().toLocaleDateString()
  };

  let patients = JSON.parse(localStorage.getItem("patients")) || [];
  patients.unshift(patient);
  localStorage.setItem("patients", JSON.stringify(patients));

  const consultation = {
    id: Date.now(),
    ticket: ticket.value,
    patientName: patient.name,
    image: patient.image,
    date: date.value,
    heure: heure.value,
    motif: motif.value,
    statut: statut.value
  };

  let consultations = JSON.parse(localStorage.getItem("consultations")) || [];
  consultations.unshift(consultation);
  localStorage.setItem("consultations", JSON.stringify(consultations));

  alert("✅ Patient et consultation enregistrés");

  location.href = "medecin_dashboard.html";
});

/* ===== LOGOUT ===== */
document.getElementById("logout").onclick = ()=>{
  localStorage.removeItem("user");
  location.href="index.html";
};
</script>

</body>
</html>
